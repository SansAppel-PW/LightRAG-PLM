<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<p>BOM审核申请流程</p>
<table border='1px' cellspacing='0'>
    <tr>
        <td rowspan="4"><p>文件状态：</p>
            <p>[√] 草稿</p>
            <p>[ ] 正式发布</p>
            <p>[ ] 正在修改</p></td>
        <td><p>文件标识：</p></td>
        <td></td>
    </tr>
    <tr>
        <td><p>当前版本：</p></td>
        <td><p>V 1.0</p></td>
    </tr>
    <tr>
        <td><p>作 者：</p></td>
        <td><p>吴小娟6</p></td>
    </tr>
    <tr>
        <td><p>完成日期：</p></td>
        <td><p>2021-12</p></td>
    </tr>
</table>
<p><strong>版 本 历 史</strong></p>
<table border='1px' cellspacing='0'>
    <tr>
        <td><p>序号</p></td>
        <td><p>变更时间</p></td>
        <td><p>版本</p></td>
        <td><p>变更人</p></td>
        <td><p>审批人</p></td>
        <td><p>变更说明</p></td>
    </tr>
    <tr>
        <td><p>1</p></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td><p>PLM2.0项目流程迁移</p></td>
    </tr>
    <tr>
        <td><p>2</p></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
    </tr>
</table>
<p><strong>目 录</strong><a id="_Toc41495858"></a><a id="_Toc428525323"></a></p>
<p><a href="#_Toc91091683">1 流程示意图 3</a></p>
<p><a href="#_Toc91091684">2 流程模板（Hikvision_BomAudit_WF） 3</a></p>
<p><a href="#_Toc91091685">3 流程节点功能描述 3</a></p>
<p><a href="#_Toc91091686">3.1 创建/修改申请（BAU-010） 3</a></p>
<p><a href="#_Toc91091687">3.2 提交系统校验项 5</a></p>
<p><a href="#_Toc91091688">3.3 流程表达式- 刷新随签子件 5</a></p>
<p><a href="#_Toc91091689">3.4 流程表达式- 设置评审对象状态_正在审阅 5</a></p>
<p><a href="#_Toc91091690">3.5 流程表达式- 判断是否规范性审核 5</a></p>
<p><a href="#_Toc91091691">3.6 流程表达式- 设置参与者 6</a></p>
<p><a href="#_Toc91091692">3.7 流程表达式- 生成差异报表（问题：需要补充逻辑） 6</a></p>
<p><a href="#_Toc91091693">3.8 流程表达式- 邮件通知抄送人 6</a></p>
<p><a href="#_Toc91091694">3.9 条件表达式- 是否需要会签 6</a></p>
<p><a href="#_Toc91091695">3.10 会签（BAU-020） 6</a></p>
<p><a href="#_Toc91091696">3.11 流程表达式- 处理授权审核信息 6</a></p>
<p><a href="#_Toc91091697">3.12 条件表达式- 是否授权审核 6</a></p>
<p><a href="#_Toc91091698">3.13 授权审核（BAU-030） 6</a></p>
<p><a href="#_Toc91091699">3.14 条件表达式- 判断流程类型 7</a></p>
<p><a href="#_Toc91091700">3.15 审核(BAU-040) 7</a></p>
<p><a href="#_Toc91091701">3.16 条件表达式- 是否跳过规范性审核 7</a></p>
<p><a href="#_Toc91091702">3.17 规范性审核（BAU-050） 7</a></p>
<p><a href="#_Toc91091703">3.18 流程表达式- 规划内容实现 7</a></p>
<p><a href="#_Toc91091704">3.19 流程表达式- 设置产品版本 8</a></p>
<p><a href="#_Toc91091705">3.20 流程表达式- 打基线及通知采购经理 8</a></p>
<p><a href="#_Toc91091706">3.21 流程表达式- SendOA 8</a></p>
<p><a href="#_Toc91091707">3.22 流程表达式- SendERP 8</a></p>
<p><a href="#_Toc91091708">3.23 条件表达式- 是否成功发送ERP 8</a></p>
<p><a href="#_Toc91091709">3.24 SAP集成异常信息（BAU-060） 8</a></p>
<p><a href="#_Toc91091710">3.25 流程表达式- 同步成品电池信息到SAP 8</a></p>
<p><a href="#_Toc91091711">3.26 流程表达式- 同步国密物料属性到SAP 8</a></p>
<p><a href="#_Toc91091712">3.27 流程表达式- 设置评审对象状态 8</a></p>
<p><a href="#_Toc91091713">3.28 流程表达式- 消防管控 9</a></p>
<p><a href="#_Toc91091714">3.29 流程表达式- 产生产品型号 9</a></p>
<p><a href="#_Toc91091715">3.30 流程表达式- 更新图纸状态 9</a></p>
<p><a href="#_Toc91091716">3.31 流程表达式- 启动CIS维护流程 9</a></p>
<p><a href="#_Toc91091717">3.32 流程表达式- 启动研发数据发布流程 9</a></p>
<p><a href="#_Toc91091718">3.33 流程表达式- 启动MBOM审核流程 9</a></p>
<p><a href="#_Toc91091719">3.34 流程表达式- 设置评审对象状态_重新工作 9</a></p>
<p><a href="#_Toc91091720">3.35 流程表达式- 删除差异报表 9</a></p>
<p><a href="#_Toc91091721">3.36 流程表达式- 设置评审对象状态 10</a></p>
<p><a href="#_Toc91091722">3.37 流程表达式- 设置流程状态 10</a></p>
<p><a id="_Toc62472951"></a></p>
<h1><a id="_Toc91091683"></a>流程示意图</h1>
<p>（问题to开发：1. 刷新随签子件，这个节点是否需要？</p>
<p>--回复：</p>
<p>
    ext.hikvision.plm.workflow.bomaudit.util.BomAuditOrderUtil.refreshBomAuditOrderSubAccompanySignParts((ext.hikvision.plm.generic.order.GeneralOrder)primaryBusinessObject);</p>
<p>
    获取表单-&gt;获取随签部件-&gt;删除随签部件-&gt;获取主对象-&gt;查找其下结构子件是否满足相关规则-&gt;满足规则加入随签部件中）</p>
<p>1.提交时根据主签审对象校验并查询子件，子件和申请单建立关联，并将子件数据添加到随签对象列表</p>
<p>
    2.刷新随签子件节点根据主签审对象校验并查询子件，过滤掉编号9开头的子件，然后清空随签子件link，重新建立关联，重新向随签对象列表添加数据</p>
<a id="_Toc62472952"></a><a id="_Toc488998664"></a>
<p><img src="images/image_02.x-emf"/></p>
<p>Uat中工作流模板在 启动MBOM流程 后有表达式：启动防爆审核流程，此流程图中未包含，需要确认下是否需要 -----已确认需要</p>
<h1><a id="_Toc91091684"></a>流程模板（Hikvision_BomAudit_WF）</h1>
<p><img src="images/image_03.png"/></p>
<h1><a id="_Toc62472953"></a><a id="_Toc91091685"></a>流程节点功能描述</h1>
<p>
    <a href="http://plmuat.hikvision.com/Windchill/ptc1/hermes?processType=BA&amp;pboid=ext.hikvision.plm.generic.order.GeneralOrder:1891305068&amp;wfoid=wt.workflow.engine.WfProcess:1886884616">http://plmuat.hikvision.com/Windchill/ptc1/hermes?processType=BA&amp;pboid=ext.hikvision.plm.generic.order.GeneralOrder:1891305068&amp;wfoid=wt.workflow.engine.WfProcess:1886884616</a>
</p>
<h2><a id="_Toc62472954"></a><a id="_Toc62474456"></a><a id="_Toc91091686"></a>创建/修改申请（BAU-010）</h2>
<ol>
    <li>前端页面：参考MOCKPLUS</li>
</ol>
<p><img src="images/image_04.png"/><img src="images/image_05.png"/></p>
<ol>
    <li><a id="_Toc62472955"></a><a id="_Toc62474457"></a>字段定义</li>
</ol>
<table border='1px' cellspacing='0'>
    <tr>
        <td><p>TAB页</p></td>
        <td><p>属性字段</p></td>
        <td><p>字段类型</p></td>
        <td><p>功能</p></td>
        <td><p>备注</p></td>
    </tr>
    <tr>
        <td rowspan="4"><p>属性</p></td>
        <td colspan="4">
            <ol>
                <li>初始字段：*物料类型，*上下文，*主题，*所属部门，*直接主管，会签人，抄送人</li>
                <li>物料类型=成品 或 软件与服务，增加显示 *是否客户专用、关联单号、*审核者
                    <ul>
                        <li>是否客户专用=基线时，再增加显示*产品系列</li>
                        <li>是否客户专用=配置时，再增加显示销售组织</li>
                        <li>物料类型=半成品时，增加显示关联单号（非必填），调取关联单号接口oaType: OA_DZ</li>
                    </ul>
                </li>
            </ol>
        </td>
    </tr>
    <tr>
        <td><p>*上下文</p></td>
        <td><p>字符串</p></td>
        <td>
            <ul>
                <li>根据主签审上下文自动获取</li>
                <li>主签审对象清空时，上下文清空</li>
            </ul>
        </td>
        <td></td>
    </tr>
    <tr>
        <td><p>*是否客户专用</p></td>
        <td><p>字符串</p></td>
        <td><p>原字段：项目类型</p></td>
        <td></td>
    </tr>
    <tr>
        <td><p>*审核者</p></td>
        <td><p>字符串</p></td>
        <td>
            <ul>
                <li>是否客户专用=基线时，取自PBI Manage-&gt; 产品系列对应的产品经理(基线)</li>
                <li>是否客户专用=定制或配置时，由关联单号带出？（开发时，补充上原逻辑）</li>
            </ul>
            <p>补充逻辑：</p>
            <p>当BOM类型为 成品 或 软件与服务 时，审核者必填，其他类型隐藏；</p>
            <p>取值从关联单号的 负责人带出；</p>
            <p><img src="images/image_06.png"/></p></td>
        <td></td>
    </tr>
    <tr>
        <td><p>主签审对象列表</p></td>
        <td colspan="4">
            <ol>
                <li>初始字段：*编号、名称、状态、版本</li>
                <li>物料类型=成品、半成品、虚拟件时，增加显示优选率、国产率、多货源率、D物料数、工艺参考代码
                    <ul>
                        <li>上下文=<s>*Internet Center*时</s>《上下文配置》-
                            BOM审核流程统计业务部优选时，再增加显示萤石I级优选率、萤石II级优选率、萤石III级优选率
                        </li>
                    </ul>
                </li>
                <li>优选率、国产率、多货源率、D物料数、萤石I级优选率、萤石II级优选率、萤石III级优选率
                    计算逻辑与原有一致（开发时，补充上原计算逻辑）
                </li>
            </ol>
            <p>补充逻辑：</p>
            <ol>
                <li>优选率：
                    <ol>
                        <li>AB优选率= (A等级物料+B等级物料)/所有子件，取两位小数</li>
                    </ol>
                </li>
                <li>国产率：
                    <ol>
                        <li>国产化子件数/子件总数 取两位小数</li>
                        <li>跳过软件，</li>
                        <li>是否国产：判断部件的供应商国家</li>
                    </ol>
                </li>
                <li>多货源率：
                    <ol>
                        <li>多源部件/子件数量 取两位小数</li>
                        <li>根据SQL查询所有子件，需要去重</li>
                        <li>
                            文档类：所有文档类型：如程序（S3物料组），维修程序（S9物料组），光盘（C3物料组），标签模版（L4物料组）、授权文件（KE01）不列入计算。
                        </li>
                    </ol>
                </li>
                <li>D物料数：
                    <ol>
                        <li>获取BOM子件，从表hik_cfg_preferredlevel_record中获取 优选等级值（注意：取到的值类型为 XXX
                            格式）
                        </li>
                    </ol>
                </li>
            </ol>
            <p><img src="images/image_07.png"/></p>
            <ul>
                <li>
                    <ol>
                        <li>取到D等级物料数量</li>
                    </ol>
                </li>
            </ul>
            <ol>
                <li>萤石I级优选率:
                    <ol>
                        <li>获取BOM子件的属性值 – 业务部优选 ，值为 &quot;I&quot; &quot;II&quot; &quot;III&quot;；</li>
                        <li>I级优选率/全部子件（排除类型 半成品和PCBA），取2位小数</li>
                    </ol>
                </li>
                <li>萤石II级优选率：II级优选率/全部子件（排除类型 半成品和PCBA），取2位小数</li>
                <li>萤石III级优选率：III级优选率/全部子件（排除类型 半成品和PCBA），取2位小数</li>
                <li>【属性】BOM类型更改时，主签审对象列表清空</li>
            </ol>
        </td>
    </tr>
    <tr>
        <td rowspan="4"><p>随签对象列表</p></td>
        <td><p>图文档对象</p></td>
        <td colspan="2">
            <ul>
                <li>
                    添加主签审对象（无论是手工添加、批量添加、还是关联单号带出）时，自动添加其关联的数字版本、原型状态的CAD文档；WIP/重新工作状态的‘说明方’文档、‘参考’文档
                </li>
                <li>勾选主签审对象，通过功能按钮“添加关联图文档”或“新建关联文档”添加</li>
            </ul>
        </td>
        <td></td>
    </tr>
    <tr>
        <td><p>MPN</p></td>
        <td colspan="2"><p>自动添加主签审对象关联的状态=WIP/重新工作、版本=A.x的MPN。
            流程结束后，MPN状态更新至稳定状态：</p>
            <ul>
                <li>
                    <ol>
                        <li>AML物料组在MustAuth表配置中的，则状态更新至未认证。且流程结束后，自动触发MPN认证流程</li>
                        <li>其他的物料组，则状态更新到已认证</li>
                    </ol>
                </li>
            </ul>
        </td>
        <td></td>
    </tr>
    <tr>
        <td><p>物料对象</p></td>
        <td colspan="2"><p>自动添加主签审对象单层BOM中状态为D1的子件或替代子件</p></td>
        <td></td>
    </tr>
    <tr>
        <td colspan="4">
            <ol>
                <li>主签审对象移除时，同时移除其随签对象</li>
                <li>流程每次提交时，重新刷新随签对象列表</li>
            </ol>
        </td>
    </tr>
    <tr>
        <td><p>板载软件列表</p></td>
        <td colspan="4"><p>【属性】BOM类型=半成品时显示</p></td>
    </tr>
    <tr>
        <td><p>维修程序列表</p></td>
        <td colspan="4"><p>【属性】BOM类型=半成品时显示</p></td>
    </tr>
</table>
<ol>
    <li><a id="_Toc62472956"></a><a id="_Toc62474458"></a>与IRDMS定配置单接口，根据关联单号带出的信息（开发时，补充原逻辑）
    </li>
</ol>
<table border='1px' cellspacing='0'>
    <tr>
        <td><p>TAB页</p></td>
        <td><p>属性字段</p></td>
    </tr>
    <tr>
        <td><p>属性</p></td>
        <td><p>补充逻辑</p>
            <p>自动带出：</p>
            <ul>
                <li>主题：对应的 项目名称</li>
                <li>产品系列：对应的 产品系列</li>
                <li>审核者：对应的 项目经理</li>
            </ul>
        </td>
    </tr>
    <tr>
        <td><p>主签审对象列表</p></td>
        <td><p>无</p></td>
    </tr>
</table>
<ol>
    <li>功能按钮（按钮功能与原有一致）</li>
</ol>
<table border='1px' cellspacing='0'>
    <tr>
        <td><p>TAB页</p></td>
        <td><p>功能按钮</p></td>
        <td><p>按钮功能和逻辑</p></td>
        <td><p>备注</p></td>
    </tr>
    <tr>
        <td rowspan="7"><p>主签审对象</p></td>
        <td><p>添加</p></td>
        <td><p>只能搜索并添加与【属性】BOM类型一致，且状态为WIP/重新工作或D1的物料</p></td>
        <td></td>
    </tr>
    <tr>
        <td><p>移除</p></td>
        <td><p>主签审对象移除时，同时移除其随签对象</p>
            <ul>
                <li>
                    <ul>
                        <li>若随签对象只关联移除的主签审对象，则移除随签列表行；</li>
                        <li>若随签对象除移除的主签审对象外，还关联其他主签审对象，则只把主签审对象从列表的BOM节点中移除。
                        </li>
                    </ul>
                </li>
            </ul>
        </td>
        <td></td>
    </tr>
    <tr>
        <td><p>导入</p></td>
        <td><p>导入前，进行系统校验。规则与原有一致（开发时，补充上原校验逻辑）</p>
            <p>补充逻辑：</p>
            <ol>
                <li>获取国际化语言</li>
                <li>若Excel无sheet 提示</li>
                <li>读取Excel内容，校验 物料编码、设计视图物料 是否存在，不存在则提示；</li>
                <li>如果物料类型是 原材料 也提示；</li>
                <li>工艺参考代码校验：
                    <ol>
                        <li>若物料类型为成品/半成品/虚拟件下的成品或半成品(物料组以2或3开头), 工艺参考代码必填</li>
                        <li>若物料采购类型为F采购且特殊采购类型为空时，设置工艺参考代码默认值为null</li>
                    </ol>
                </li>
                <li>如果添加的成品、半成品、虚拟BOM，查询优选信息</li>
            </ol>
            <p>获取 此物料的上下文 是否有配置 只有配置的 才去分析 业务部优选率</p>
            <p><img src="images/image_08.png"/></p></td>
        <td><p>原：批量添加</p></td>
    </tr>
    <tr>
        <td><p>BOM规范性校验</p></td>
        <td>
            <ul>
                <li>【属性】BOM类型=成品或半成品时显示</li>
                <li>
                    BOM类型=成品时，显示成品检查规则；BOM类型=半成品时，显示半成品检查规则；系统对勾选对象+勾选校验项进行校验
                </li>
            </ul>
        </td>
        <td><p>成品BOM校验规范增加两条：</p>
            <ol>
                <li>硬盘与平台兼容性校验（RMS20220120_019）</li>
                <li>物料是否属于软件支持硬件清单（RMS20211118_026）</li>
            </ol>
        </td>
    </tr>
    <tr>
        <td><p>产品安规符合性校验</p></td>
        <td>
            <ul>
                <li>【属性】BOM类型=半成品时显示</li>
                <li>后台调用【产品CDF导出】工具运算，并在页面上提示CDF导出报表中含有备注信息的内容（<em>ITRMS20190828_007_产品认证需求传递方案</em>）
                </li>
            </ul>
        </td>
        <td></td>
    </tr>
    <tr>
        <td><p>BOM物料诊断报告</p></td>
        <td><p><em>RMS20200723_009BOM物料诊断报告</em></p>
            <ul>
                <li>选择显示模块有记忆功能，每次记录上次勾选的模块</li>
                <li>权限管控：按照当前产品库的上下文管理方式延续权限进行管控</li>
            </ul>
        </td>
        <td><p>有调用SAP的的接口获取物料计划交货天数</p></td>
    </tr>
    <tr>
        <td><p>批量设置工艺参考代码 </p></td>
        <td><p>【属性】BOM类型=成品或半成品时显示</p></td>
        <td></td>
    </tr>
    <tr>
        <td><p>随签对象列表</p></td>
        <td><p>移除</p></td>
        <td><p>/</p></td>
        <td></td>
    </tr>
    <tr>
        <td rowspan="2"><p>节点按钮</p></td>
        <td><p>差异预览</p></td>
        <td><p>比较主签审对象与“保存自”对象的差异</p></td>
        <td></td>
    </tr>
    <tr>
        <td><p>预览差异至组件</p></td>
        <td><p>开发时，补充上原有功能逻辑</p>
            <p>补充逻辑：</p>
            <p>ext/report/previewBomCompareReport</p>
            <p>若当前BOM是另存出来的，则比较 原BOM与另存BOM的差异，可按查看差异，也可下载对应的Excel。</p>
            <p><img src="images/image_09.png"/></p>
            <p>TO测试：可以使用另存为功能将已有的BOM生成新的，改动几个物料后添加到审核流程中即可查看差异。</p>
            <p><img src="images/image_10.png"/></p>
            <p><img src="images/image_11.png"/></p></td>
        <td></td>
    </tr>
</table>
<h2><a id="_Toc91091687"></a>提交系统校验项</h2>
<table border='1px' cellspacing='0'>
    <tr>
        <td><p><strong>　</strong></p></td>
        <td><p><strong>校验项</strong></p></td>
    </tr>
    <tr>
        <td rowspan="2"><p>前端校验</p></td>
        <td><p>校验必填项</p></td>
    </tr>
    <tr>
        <td><p>BOM类型为成品或者软件与服务，并且项目类型为基线时，产品系列必填</p></td>
    </tr>
    <tr>
        <td rowspan="3"><p>提交前校验（报错提示）</p></td>
        <td><p>
            <s>如果BOM类型是成品/半成品（包括虚拟件的产品/半成品）时，校验列“工艺参考代码（ProcessReferenceCode）”为必填（错误提示）</s>
        </p></td>
    </tr>
    <tr>
        <td><p>校验签审对象BOM子件 link上的属性 是否ME辅料 是否为空（错误提示）</p></td>
    </tr>
    <tr>
        <td><p>海外基线说明书物料校验-成品物料满足以下条件时：上下文属于“上下文配置-
            BOM审核提交海外18国多语言资料校验”，采购类型=E自制，销售范围=海外，标配/中性=标配，品牌= &quot;HIKVISION&quot;/&quot;HIWATCH&quot;/
            &quot;HILOOK&quot;</p>
            <p>校验物料是否包含102014物料组的子件</p></td>
    </tr>
    <tr>
        <td rowspan="15"><p>提交前校验（警告提示）</p></td>
        <td><p><strong>原材料常规:</strong>以下物料未维护环保RoHS2.0文件，存在环保风险，若销售地区为海外/全球，产品将限制发布。（取自合规信息页）
        </p></td>
    </tr>
    <tr>
        <td><p><strong>原材料设计件无AML管理：</strong>以下物料由于供应商未签署RoHS协议，属环保风险物料。请转入制造商部件管理，并维护相关RoHS2.0符合性证明资料。（取自供应商协议数据库）
        </p></td>
    </tr>
    <tr>
        <td><p><strong>环保标识：</strong>以下物料环保标识值为非RoHS物料，产品需经过报备申请才能使用。（取自IPN类型属性）</p>
        </td>
    </tr>
    <tr>
        <td><p><strong>环保类型：</strong>以下外购成品环保类型不符合RoHS2.0(十项)，存在环保风险，若销售地区为海外/全球，产品将限制发布。（取自IPN类型属性）
        </p></td>
    </tr>
    <tr>
        <td><p><strong>能效标识：</strong>以下物料能效等级为ERP V级，不满足 VI级能效要求，欧洲、美国等海外项目不能使用（取自IPN分类属性）
        </p></td>
    </tr>
    <tr>
        <td><p>检验物料产品对应的产品型号是否已经存在，是否重复，产品系列:{0}中存在相同的产品型号:{1}</p></td>
    </tr>
    <tr>
        <td><p>BOM '{0}', 子件'{1}'属'{2}'上下文。此流程将提交给'{3}'进行授权审核。请确认是否需要用此子件。</p></td>
    </tr>
    <tr>
        <td><p>判断父项是否是PCBA硬件库，并且是半成品，校验子件是否重复</p></td>
    </tr>
    <tr>
        <td><p>校验PCBA半成品子项物料，有无PCB版，排序字符串，位号等</p></td>
    </tr>
    <tr>
        <td><p>校验子件和替代件的状态，如果物料状态是E1，则提示子件已进入停产阶段</p></td>
    </tr>
    <tr>
        <td><p>校验Bom子件是否含有S301软件，且S301软件受限状态为成inactive 状态</p></td>
    </tr>
    <tr>
        <td><p>验证BOM子类数量和单位用量的乘积小于4位小数 </p></td>
    </tr>
    <tr>
        <td><p>校验BOM中子件位号数小于数量, 请确认后添加。</p></td>
    </tr>
    <tr>
        <td><p>校验海外/全球成品所有层BOM中是否含有物料大类为1019的虚拟件</p></td>
    </tr>
    <tr>
        <td><p>如果是半成品，在提示用户请点击【产品安规符合性校验】按钮</p></td>
    </tr>
    <tr>
        <td rowspan="30"><p>提交校验(错误提示)</p></td>
        <td><p>BOM类型是成品且项目类型是配置校验销售组织是否存在</p></td>
    </tr>
    <tr>
        <td><p>主要对象列表为空</p></td>
    </tr>
    <tr>
        <td><p>校验物料是否被检出</p></td>
    </tr>
    <tr>
        <td><p>校验所有物料是否跨库签审</p></td>
    </tr>
    <tr>
        <td><p>BOM签审只允许 D1、WIP、Rework 3种状态</p></td>
    </tr>
    <tr>
        <td><p>校验物料状态是否已经到达过D2及以后的状态</p></td>
    </tr>
    <tr>
        <td><p>强制认证物料限制D1状态不可BOM签审</p></td>
    </tr>
    <tr>
        <td><p>检查物料类型与BOMType是否一致</p></td>
    </tr>
    <tr>
        <td><p>校验物料的是否客户专用属性与申请单的类型是否不一致</p></td>
    </tr>
    <tr>
        <td><p>
            校验主签审对象的产品系列是否和bom签审单选择的产品系列相同(前提条件：物料有产品系列，并且和申请单填写的不一致时才提示)</p>
        </td>
    </tr>
    <tr>
        <td><p>校验是否关联了 ECN</p></td>
    </tr>
    <tr>
        <td><p>校验是否正在其它的通用表单中运行</p></td>
    </tr>
    <tr>
        <td><p>校验签审对象关联的CAD图纸如果为数字版本状态必须为原型</p></td>
    </tr>
    <tr>
        <td><p>需要选择主对象,否则随签对象：不能提交BOM审核(随签对象选择的bom节点必须在主签审对象中)</p></td>
    </tr>
    <tr>
        <td><p>主对象与参考文档已建立关系，不能提交BOM审核</p></td>
    </tr>
    <tr>
        <td><p>主对象与说明文档已建立关系，不能提交BOM审核</p></td>
    </tr>
    <tr>
        <td><p>
            校验半成品所在的产品库包含《硬件》字样，该物料必须关联单板生产说明书（1、物料直接关联，2、BOM签审单随签列表）；</p>
        </td>
    </tr>
    <tr>
        <td><p>
            判断是否是自制，如果是校验产品型号、系列和产品线是否为空（查询物料关联的物料料号申请单GeneralOrder，如果有，执行该项校验）</p>
        </td>
    </tr>
    <tr>
        <td><p>请先走完料号申请流程，再走BOM审核流程。请在 物料详细信息&gt;关联单号&gt;主物料关联单子 查看</p></td>
    </tr>
    <tr>
        <td><p>检验主签审对象的AML状态 （若AML状态=正在审阅、版本=A.x，则系统报错：物料XXX关联的AML XXX，请先完成AML关联的流程XXXX,
            使其状态达到稳定）</p></td>
    </tr>
    <tr>
        <td><p>BOM子件数量非零校验，子件和子件替代件的数量不能零</p></td>
    </tr>
    <tr>
        <td><p>检验PCBA BOM中软件的排序字符串</p></td>
    </tr>
    <tr>
        <td><p>类型=成品、销售地区=海外/全球，校验BOM中是否含有国密物料或受限㓡的半成品</p></td>
    </tr>
    <tr>
        <td><p>校验BOM子件是否有正在走退市流程</p></td>
    </tr>
    <tr>
        <td><p>BOM类型是成品，校验海外基线多语言说明书，&quot;物料编码{0}BOM中没有{1}海外基线多语言说明书，请确认后添加。
            BOM类型是成品，上下文=《上下文配置》：BOM审核提交海外18国多语言资料校验，属性值Y校验是否关联102014类型的物料， </p>
        </td>
    </tr>
    <tr>
        <td><p>物料类型=成品、来源=E自制、销售地区=海外、标配/中性=标配、品牌= HIKVISION| HiWatch|
            HiLook（不区分大小写）Hikvision，Hiwatch，Hilook|，上下文= 《BOM审核提交海外18国多语言资料校验》配置表内的，则校验单层BOM中是否含‘102014
            18国多语言资料’子件（RMS20220517_063）</p></td>
    </tr>
    <tr>
        <td><p>随签的物料对象列表中不允许有成品物料。报错：成品XXX，不允许随签。 （RMS20220317_056）</p></td>
    </tr>
    <tr>
        <td><p>非萤石的物料BOM中不允许使用萤石物料(物料在“Internet Center”上下文中，及为萤石物料)</p></td>
    </tr>
    <tr>
        <td><p>根据配置判断主签审对象，子件是校验最新版本还是校验最新稳定版本<br/>
            I.如果是配置的物料大类，则校验子件最新稳定版本，如果不是配置的物料大类，则校验最新版本<br/>
            II.如果子件状态是WIP，如果是收集部件，不取最新稳定版本，如果不是收集部件，判断是否需要取最新稳定状态</p>
            <p>如果子件状态是重新工作或正在审阅时，判断是否需要取最新稳定版本</p>
            <p> III.判断子件是否被检出<br/> IV.获取子件关联的正在运行的流程，如果存在正在运行的流程：<br/> 如果流程&lt;是否客户专用&gt;<s>项目类型</s>是配置，子件状态小于M1则提示子件存在关联的流程<br/>
                如果流程&lt;是否客户专用&gt;<s>项目类型</s>不是配置，子件状态小于D2则提示子件存在关联的流程<br/>
                如果关联的流程是退市流程，且状态不是E1则提示子件存在关联的流程<br/>
                V.如果流程项目类型是配置，子件状态必须为S1-E1(D1状态的标签、WIP的收集部件除外)<br/> VI.如果流程项目类型不是配置:<br/>
                子件状态必须为D1-E1(WIP的收集部件除外)<br/> 子件状态是D1-E1收集部件，校验第15项整个校验<br/>
                子件状态是D1的非收集部件，不能有BOM结构（过滤bom结构中的收集部件）<br/> 子件状态是D1的非收集部件，强制认证物料限制“不允许随签”
            </p></td>
    </tr>
    <tr>
        <td><p>
            注意：部分流程不锁定物料，如国际商品条码(EAN)申请、CIS维护流程、电子机电物料3D建模流程、物料参考替代关系维护流程</p>
        </td>
    </tr>
</table>
<h2><a id="_Toc91091688"></a><a id="_Toc62472965"></a><a id="_Toc62474467"></a>流程表达式- 刷新随签子件</h2>
<p>重新获取BomAuditOrder的随签子件并建立Link关系</p>
<h2><a id="_Toc91091689"></a>流程表达式- 设置评审对象状态_正在审阅</h2>
<p>流程提交时，评审对象状态:</p>
<ul>
    <li>
        <ul>
            <li>审核对象状态为“正在审阅”</li>
            <li>WIP/重新工作的随签对象状态设置为“正在审阅”</li>
        </ul>
    </li>
</ul>
<h2><a id="_Toc91091690"></a>流程表达式- 判断是否规范性审核</h2>
<table border='1px' cellspacing='0'>
    <tr>
        <td><p>判断条件</p></td>
        <td><p>备注</p></td>
    </tr>
    <tr>
        <td>
            <ul>
                <li>
                    非成品并且非半成品，如果主签审对象都在物料大类/组配置“非成品半成品BOM审核跳过规范性审核”中则跳过规范性审核，否则不跳过
                </li>
                <li>如果是硬件库半成品物料，【BOM校验规范】和【约束项校验】的校验都通过，则直接跳过规范性审核，否则不跳过</li>
                <li>主签审对象中存在非E自制、非F30、非F20的成品或没有结构的成品，需要规范性审核</li>
            </ul>
        </td>
        <td><p>配置表：XXXX</p></td>
    </tr>
</table>
<h2><a id="_Toc91091691"></a>流程表达式- 设置参与者</h2>
<table border='1px' cellspacing='0'>
    <tr>
        <td><p>设置参与者</p></td>
        <td><p>器件工程师取自物料组角色配置，需要规范性审核才设置器件工程师，参与&quot;规范性审核&quot;节点<br/>部门主管取自页面的部门主管<br/>审核者取自页面的审核者，参与&quot;审核&quot;节点
        </p></td>
    </tr>
</table>
<h2><a id="_Toc91091692"></a>流程表达式- 生成差异报表（开发时，补充原逻辑）</h2>
<p>生成差异报表</p>
<ol>
    <li>ITRMS20181022_045BOM签审中差异直接与“保存自对象”最新BOM进行比较</li>
</ol>
<p>补充逻辑（MadeFromBomCompareService）：</p>
<h2><a id="_Toc91091693"></a>流程表达式- 邮件通知抄送人</h2>
<p>邮件通知抄送人，抄送人取自页面填写</p>
<h2><a id="_Toc91091694"></a>条件表达式- 是否需要会签</h2>
<p><s>根据页面是否勾选，判断流程是否到“会签”节点</s></p>
<p>改为：表单页面会签人非空时，则需要会签；为空时，不需要会签</p>
<h2><a id="_Toc91091695"></a>会签（BAU-020）</h2>
<p>前端页面：参考MOCKPLUS</p>
<p><em>ITRMS20190919_054BOM审核申请流程中增加会签功能</em></p>
<h2><a id="_Toc91091696"></a>流程表达式- 处理授权审核信息</h2>
<p>处理授权审核信息，保存子件授权数据</p>
<p>设置授权审核节点参与者，根据物料上下文取配置表中的人员（配置表：子件授权配置表）</p>
<h2><a id="_Toc91091697"></a>条件表达式- 是否授权审核</h2>
<p>根据“处理授权审核信息”表达式判断是否需要“授权审核”</p>
<p>配置表：《子件授权审核配置表》</p>
<h2><a id="_Toc91091698"></a>授权审核（BAU-030）</h2>
<p>前端页面：参考MOCKPLUS</p>
<p><img src="images/image_12.png"/></p>
<ol>
    <li>
        同一个子-父件有多人审核时，只要其中一人审核即可；所有子-父件都已审核过时，该节点结束；只要有一人驳回，则流程回退至修改节点
    </li>
    <li>前端页面：参考MOCKPLUS</li>
</ol>
<h2><a id="_Toc91091699"></a>条件表达式- 判断流程类型</h2>
<table border='1px' cellspacing='0'>
    <tr>
        <td><p>判断流程类型</p></td>
        <td><p>判断页面选择的BOM类型、项目类型<br/>1.只要存在原材料F30或F20，跳过“审核”节点<br/>2.其它情况到“审核”节点</p>
        </td>
    </tr>
</table>
<h2><a id="_Toc91091700"></a>审核(BAU-040)</h2>
<ul>
    <li>
        <ol>
            <li>前端页面：参考MOCKPLUS</li>
        </ol>
    </li>
</ul>
<p><img src="images/image_13.png"/></p>
<ul>
    <li>
        <ol>
            <li>节点校验项（参考创建/提交节点）</li>
        </ol>
    </li>
</ul>
<table border='1px' cellspacing='0'>
    <tr>
        <td><p>校验项</p></td>
        <td><p>备注</p></td>
    </tr>
    <tr>
        <td><p>校验物料的Rohs2.0(10项)：</p>
            <ul>
                <li>
                    原材料常规:以下物料未维护环保RoHS2.0文件，存在环保风险，若销售地区为海外/全球，产品将限制发布。（取自合规信息页）
                </li>
                <li>
                    原材料设计件无AML管理：以下物料由于供应商未签署RoHS协议，属环保风险物料。请转入制造商部件管理，并维护相关RoHS2.0符合性证明资料。（取自供应商协议数据库）
                </li>
                <li>环保标识：以下物料环保标识值为非RoHS物料，产品需经过报备申请才能使用。（取自IPN类型属性）</li>
                <li>
                    环保类型：以下外购成品环保类型不符合RoHS2.0(十项)，存在环保风险，若销售地区为海外/全球，产品将限制发布。（取自IPN类型属性）
                </li>
            </ul>
        </td>
        <td></td>
    </tr>
</table>
<h2><a id="_Toc91091701"></a>条件表达式- 是否跳过规范性审核</h2>
<p>根据“判断是否规范性审核”表达式的结果判断是否跳过&quot;规范性审核&quot;节点（开发时，补充上判断逻辑）</p>
<p><em>RMS20210126_017针对PCBA校验中规范性审核进行优化</em></p>
<p><em>RMS20210709_022BOM校验规范需增加一行</em></p>
<p>补充逻辑：</p>
<p>获取BOM类型，判断：</p>
<ol>
    <li>非 成品 且非 半成品：
        <ol>
            <li>获取 是否是需要跳过规范性检查的类型（配置文件：物料大类/物料组配置 非成品半成品BOM审核跳过规范性审核）</li>
        </ol>
    </li>
</ol>
<p><img src="images/image_14.png"/></p>
<ul>
    <li>
        <ol>
            <li>若当前签审主对象在这些类型中，则跳过规范性审核；</li>
        </ol>
    </li>
</ul>
<ol>
    <li>等于 半成品：
        <ol>
            <li>获取 order所在容器</li>
            <li>查找 上下文分类规则配置 获取对应的库</li>
        </ol>
    </li>
</ol>
<p><img src="images/image_15.png"/></p>
<ul>
    <li>
        <ol>
            <li>如果为 硬件库 再判断签审主对象part，若满足 bom签审流程checkListAction ，则跳过，否则不跳过</li>
        </ol>
    </li>
</ul>
<ol>
    <li>其他情况：
        <ol>
            <li><em>获取</em> {wt.home}/ext/ hikvision/ conf/<em>hikconfig.properties配置文件中的 bomAudit_skip_class
                配置值（分类号）若order关联主对象包含了这些分类则跳过</em></li>
            <li><em>若采购类型非自制 且 主签审对象 采购类型非F采购 且 特殊采购非 30外协 20委外采购 跳过</em></li>
            <li><em>上下文含：“PCBA”时跳过“规范性审核环节”</em></li>
        </ol>
    </li>
</ol>
<h2><a id="_Toc91091702"></a><a id="_Toc62472968"></a><a id="_Toc62474470"></a>规范性审核（BAU-050）</h2>
<ol>
    <li>前端页面：参考MOCKPLUS</li>
</ol>
<p><img src="images/image_16.png"/></p>
<ol>
    <li>字段逻辑</li>
</ol>
<table border='1px' cellspacing='0'>
    <tr>
        <td><p>属性字段</p></td>
        <td><p>功能</p></td>
        <td><p>备注</p></td>
    </tr>
    <tr>
        <td><p>启动CIS维护流程</p></td>
        <td rowspan="2"><p><em>RMS20201116_031虚拟件增加触发封装信息（CIS库和3D）</em></p>
            <ol>
                <li>表单【属性】BOM类型=虚拟件，且主签审对象物料大类/组在系统配置表：《物料大类/组配置》-&gt;虚拟件BOM审核触发CIS库和创建3D及空白ASM时，显示</li>
            </ol>
            <ul>
                <li>若启动CIS维护流程勾选“是“，则创建3D自动勾选，可编辑</li>
                <li>若启动CIS维护流程勾选未勾选，则创建3D处于非激活状态（不可勾选）</li>
            </ul>
            <ol>
                <li>若有多个主签审对象符合触发条件时，则按物料组维度分单触发</li>
            </ol>
        </td>
        <td></td>
    </tr>
    <tr>
        <td><p>创建3D</p></td>
        <td></td>
    </tr>
</table>
<ol>
    <li>功能按钮</li>
</ol>
<table border='1px' cellspacing='0'>
    <tr>
        <td><p>功能按钮</p></td>
        <td><p>按钮功能和逻辑</p></td>
        <td><p>备注</p></td>
    </tr>
    <tr>
        <td><p>约束项校验</p></td>
        <td><p>问题：开发时，补充约束项逻辑</p>
            <p>（1）<em>ITRMS20190221_048_因主芯片关联程序调整业务规则解决方案</em></p>
            <p>子件如果为软件（S9），排序字符串必须为维修，且备注不能为空</p>
            <p>补充逻辑：</p>
            <ol>
                <li>如果子件为1012物料大类，跳过校验</li>
                <li>如果是S3软件，排序字符串必须为“在线”或“离线”，备注不能为空</li>
                <li>如果是S9软件，排序字符串必须为“维修”，备注不能为空</li>
            </ol>
            <p>4.其它物料，位号和备注不能为空</p></td>
        <td></td>
    </tr>
</table>
<h2><a id="_Toc91091703"></a><a id="_Toc62472982"></a><a id="_Toc62474484"></a>流程表达式- 规划内容实现</h2>
<table border='1px' cellspacing='0'>
    <tr>
        <td><p>功能</p></td>
        <td><p>备注</p></td>
    </tr>
    <tr>
        <td><p>创建审核单中关联的零部件与文档随签对象表格中文档之间的关联关系. </p>
            <ul>
                <li>如果随签文档表格中的文档与对应的审核对象间没有关系的创建关联关系。(根据文档类型创建参考或说明关系)
                </li>
                <li>随签对象中的CAD文档：建立跟对应物料对象间的“所有者”关系</li>
                <li>根据板载软件列表数据，创建板载软件并和物料搭建BOM关系</li>
                <li>根据维修程序列表数据，创建维修软件并和物料搭建BOM关系</li>
                <li>展开BOM，若包含国密物料，【销售管控】自动维护“01 海外销售限制 – 国密物料”（<em>ITRMS20190907_001_物料管控：
                    国密物料 - </em>半成品或销售地区=国内的成品，展开所有层BOM，若包含国密物料（备注：只有物料组101110有这个分类属性），&lt;销售管控&gt;自动维护“01海外销售限制
                    – 国密物料<em>)</em></li>
            </ul>
        </td>
        <td></td>
    </tr>
</table>
<h2><a id="_Toc91091704"></a>流程表达式- 设置产品版本</h2>
<p>设置产品版本的属性到主签审对象上</p>
<p><em>PLM20180705_01_产品版本财务归集方案优化</em></p>
<p>
    根据页面项目编号调动irdms接口获取产品版本，升级物料小版本，将产品版本设置到物料的com.hikvision.plm.ProductVersion属性中</p>
<h2><a id="_Toc91091705"></a>流程表达式- 打基线及通知采购经理</h2>
<ul>
    <li>创建试制基线</li>
    <li>向采购经理发送邮件通知，项目编号不为空且采购经理不为空，并且BOM类型是半成品或基线成品才发送邮件</li>
</ul>
<h2><a id="_Toc91091706"></a>流程表达式- SendOA</h2>
<p>发送OA加密配置表，成品类型和上下文配置判断是否发送 </p>
<ol>
    <li><em>ITRMS20190117_020PLM系统BOM审核申请流程结束节点发送新建型号到OA加密配置表
        （问题：哪个配置表？）--回复：服务器目录{wt.home}/ext/</em> <em>hikvision /</em> <em>conf /wsconfig.properties</em>
    </li>
</ol>
<p><img src="images/image_17.png"/></p>
<h2><a id="_Toc91091707"></a>流程表达式- SendERP</h2>
<p>集成SAP</p>
<h2><a id="_Toc91091708"></a>条件表达式- 是否成功发送ERP</h2>
<p>若失败，则流程到‘SAP集成异常信息’</p>
<h2><a id="_Toc91091709"></a>SAP集成异常信息（BAU-060）</h2>
<p>前端页面：参考MOCKPLUS</p>
<h2><a id="_Toc91091710"></a>流程表达式- 同步成品电池信息到SAP</h2>
<p>展开BOM计算物料的电池属性并同步到SA。计算逻辑《ITRMS20190509_036_特殊产品&amp;物料含危险品（电池）识别》</p>
<p>补充逻辑</p>
<ol>
    <li>获取主签审对象列表物料</li>
    <li>计算物料电池属性
        <ol>
            <li>只有成品和半成品才计算电池属性</li>
            <li>获取主签审物料中的E自制和F30物料</li>
            <li>查询物料全bom中的1019电池和含有电池属性的物料</li>
            <li>循环查询F采购物料本身关联的电池和物料子件关联的电池</li>
        </ol>
    </li>
    <li>设置物料电池属性</li>
    <li>同步电池属性到SAP
        <ol>
            <li>查询物料的电池属性</li>
            <li>记录电池变化</li>
            <li>同步电池到SAP</li>
        </ol>
    </li>
</ol>
<p>获取主签审对象列表中的成品物料，计算并记录物料已完成的认证大类(包含自身已完成的认证和通过转证方式完成的认证大类)</p>
<h2><a id="_Toc91091711"></a>流程表达式- 同步国密物料属性到SAP</h2>
<p>同步&quot;国密物料&quot;,&quot;销售管控&quot;属性到SAP</p>
<ol>
    <li>获取主签审列表中，国密物料或销售管控属性非空的物料</li>
    <li>发送&quot;国密物料&quot;,&quot;销售管控&quot;属性到SAP</li>
</ol>
<h2><a id="_Toc91091712"></a>流程表达式- 设置评审对象状态</h2>
<p>设置审核对象状态为“D2”</p>
<ul>
    <li>
        <ul>
            <li>随签对象中的部件设置为“D2”</li>
            <li>随签图文档中的“正在审阅”文档设置为“已发布”</li>
            <li>
                设置主签审对象关联图纸状态，数字版本修订为字母版本，图纸获取drw，如果是数字版本则修改为字母版本并设置已发布状态
            </li>
            <li>MPN状态设置规则：</li>
            <li>AML物料组在MustAuth表配置中的，则状态更新至未认证。且流程结束后，自动触发MPN认证流程</li>
            <li>其他的物料组，则状态更新到已认证</li>
        </ul>
    </li>
</ul>
<h2><a id="_Toc91091713"></a>流程表达式- 消防管控</h2>
<p>bom签审符合消防管控的物料，展开bom设置消防管控等级标记并发送sap</p>
<p><em>（1）RMS20201029_055消防管控自动标记版本升级</em></p>
<ul>
    <li>主签审对象上下文=Fire-*时，BOM审核流程结束后，下层所有子件物料（问题：1. 单层BOM还是所有层BOM? 2. 若子件已打上消防管控，如何处理
        3. 消防管控几级）升级一个小版本、打上消防管控类型，并发送SAP
    </li>
    <li>把BOM审核申请单添加入主签审对象的《消防管控历史记录》布局内，备注列填写：自动打消防管控标识</li>
</ul>
<p>补充逻辑：</p>
<p>ext.hikvision.plm.workflow.bomaudit.util.BomAuditOrderUtil.intelligentFireControl(primaryBusinessObject);</p>
<ol>
    <li>获取ORDER关联的主签审物料</li>
    <li>获取主对象的初始工厂 ，排除非 VIEW_8000 VIEW_4000 VIEW_8002 VIEW_9000 VIEW_2100 VIEW_3162 VIEW_3040 VIEW_2160
        VIEW_2280 VIEW_2120 VIEW_2102 VIEW_2490 VIEW_2230 VIEW_2290 VIEW_1000
    </li>
    <li>过滤出 IBA属性：管控类型 为 FC_LV开头的物料</li>
    <li>查询bom签审符合消防管控的物料</li>
    <li>查询符合条件物料的全bom</li>
    <li>查询没有维护消防管控的物料（管控类型 非 FC_LV开头的物料）</li>
    <li>设置物料的消防管控属性：
        <ol>
            <li>
                处理消防管控，如果为空，则根据物料组设置FC等级，如果没有FC等级，则加FC等级，不覆盖以前的值，（如果是消防管控类型物料组，默认FC_LV5，否则，默认FC_LV4）
            </li>
            <li>同步更新各M视图</li>
        </ol>
    </li>
    <li>去除无需发送SAP的物料</li>
    <li>维护数据库表BOM_FIRECONTROLINFOS，记录物料ida2a2，申请单编号，消防管控类型</li>
    <li>移除已经在SAP维护了消防管控等级的物料</li>
    <li>发送SAP</li>
</ol>
<h2><a id="_Toc91091714"></a>流程表达式- 产生产品型号</h2>
<p>成品和软件与服务搭建PBI关系和平台关系</p>
<p>补充逻辑</p>
<p>1.获取主签物料、随签子件中的所有成品、软件与服务</p>
<p>2.如果是“物料料号申请流程”创建的物料</p>
<p> 1）根据物料A版本获取关联的料号申请单</p>
<p> 2）如果BOM审核申请单的产品系列和物料料号申请单的产品型号都不为空，根据产品系列和产品型号查询PBI结构树</p>
<p> 3）如果物料已经与PBI建立关联，不做任何操作；否则，物料需要与PBI结构建立关联</p>
<p> 4）如果产品型号已经存在，可以直接使用；否则，需要先创建产品型号；</p>
<p> 5）产品系列与产品型号创建PbiLink，产品型号与物料创建PbiLink</p>
<p>3.如果不是上述物料，</p>
<p>
    1）如果是Hikvision_MaterialRequest_WF流程创建的物料，根据流程获取ApplyDoc；如果是另存物料，没有流程，根据物料获取ApplyDoc</p>
<p> 2）从ApplyDoc获取产品型号、产品系列、产品系列编号、产品线、BOM编码、BOM名称、平台编码</p>
<p> 3）根据产品系列编号查询产品系列，如果不存在，再根据产品系列名称查询</p>
<p> 4）如果产品系列不为空，获取物料分类属性：产品型号。根据产品系列和产品型号查询PBI结构树</p>
<p> 5）执行2（3）-（5）项操作</p>
<p> 6）根据平台编码，获取平台，搭建平台跟产品型号关系</p>
<h2><a id="_Toc91091715"></a>流程表达式- 更新图纸状态</h2>
<p>签审对象关联的CAD文档状态为设置为已发布，会展开CAD图纸结构设置结构数字版本图纸的状态已发布</p>
<h2><a id="_Toc91091716"></a>流程表达式- 启动CIS维护流程 </h2>
<table border='1px' cellspacing='0'>
    <tr>
        <td><p>启动条件</p></td>
        <td><p>备注</p></td>
    </tr>
    <tr>
        <td><p>“规范性审核”节点选择“启动CIS维护流程”，部分虚拟件物料组（配置表《物料大类/组配置》-&gt;
            虚拟件BOM审核触发CIS库和创建3D及空白ASM）启动CIS维护流程</p>
            <p>补充逻辑</p>
            <p>1.规范性审核时勾选了“启动CIS维护流程“<br/>2.申请单物料类型为虚拟件；</p>
            <p>3.物料属于“虚拟件BOM审核触发CIS库和创建3D及空白ASM“配置的物料组</p>
            <p>4.如果启动CIS维护流程时报错，系统不抛出异常，只记录异常信息，并发送异常通知邮件</p>
            <p>5.每个物料启动一个CIS流程，根据规范性审核时是否勾选“启动3D建模“，决定CIS流程是否额外启动3D建模流程</p>
            <p>6.CIS流程参与者：从系统配置-常用角色配置中获取：</p>
            <p>Component Enginner Director器件工程师主管</p>
            <p>FootprintAdmin CIS库Footprint管理员</p>
            <p>SymbolAdmin CIS库Symbol管理员</p>
            <p>FootprintDepartLeader Footprint管理员部门主管</p>
            <p>SymbolDepartLeader Symbol管理员部门主管</p>
            <p>
                7.主签审对象列表数据字段oid、name、number、infoUrl、showPartName、version、state、pakageName、processSpecification、symbolName、valueAttr、PINNumber、pinOrderSpecification、materialGroup、hideMaintain</p>
            <p>8.表单数据：</p>
            <p>CIS维护项：封装维护√隐藏维护×器件禁用×</p>
            <p>主题：取物料名称</p>
            <p>上下文：取物料上下文</p>
            <p>流程创建者：取物料创建者</p>
            <p>9.流程与物料建立formLink</p></td>
        <td><p>1-5为启动CIS维护流程的前提条件</p>
            <p>6-9为CIS维护流程申请单属性及数据取值逻辑</p></td>
    </tr>
</table>
<h2><a id="_Toc91091717"></a>流程表达式- 启动研发数据发布流程</h2>
<table border='1px' cellspacing='0'>
    <tr>
        <td><p>启动条件</p></td>
        <td><p>备注</p></td>
    </tr>
    <tr>
        <td><p>
            <em>ITRMS20190221_007硬件达到D2状态，结构含下层子件达到D2状态时，PLM触发提醒邮件给申请人，提示物料需要发布到S1</em>
        </p>
            <ul>
                <li>D2状态、带BOM、上下文在系统配置表《上下文配置》里的结构件，自动启动研发数据流程</li>
                <li>
                    根据物料创建者、上下文分组，同一创建者、同一上下文物料启动一个研发数据流程。若物料创建者的PLM帐号已取消，则对应的物料不触发
                </li>
                <li>研发数据发布申请单： BOM类型=原材料，主题=[BOM签审流程单号]+[BOM签审主题]_ 结构件带BOM发布_Auto</li>
            </ul>
        </td>
        <td><p>问题to业务：研发数据发布的新规则，确认结构件无论是否带BOM都可状态随签到S1，还是所有结构件都采用此类方式？</p>
        </td>
    </tr>
</table>
<h2><a id="_Toc91091718"></a>流程表达式- 启动MBOM审核流程（开发时，补充上逻辑）</h2>
<p>承接EBOM流程创建MBOM</p>
<p>补充逻辑</p>
<p>1. 将EBOM数据传递至MBOM </p>
<p>1）清空表单随签对象列表，部门，部门主管数据 </p>
<p>2）如果销售范围不为空，获取主签审物料列表，为每个物料数据设置销售范围</p>
<p>2.扩视图</p>
<p> 1）获取主签审对象</p>
<p>2）如果物料“MPART停用状态“属性为”停用“，则跳过该物料</p>
<p> 3）根据物料初始工厂，获取对应的初始工厂视图，如果非Design视图，需要启MBOM子流程</p>
<p> 4）获取系统中已存在的、“MPART停用状态“非停用状态的工厂视图，需要启MBOM子流程</p>
<p> 5）部分视图额外扩视图</p>
<ol>
    <li>初始工厂视图=4000，根据“工厂物料配置-4000工厂额外视图配置”额外扩8000工厂</li>
    <li>初始工厂视图=8000，物料组属于303801-303807范围，额外扩9000</li>
    <li>2160，原材料，额外扩8000</li>
    <li>2280，原材料，额外扩9000；半成品，且属于“工厂物料配置-机器人PCBA”物料组，额外扩9000</li>
    <li>2660，原材料，额外扩9000；半成品，且属于“工厂物料配置-机器人PCBA”物料组，额外扩9000</li>
    <li>2550，根据“工厂物料配置-2550工厂额外视图配置”额外扩2100工厂</li>
    <li>
        2490，原材料，额外扩9000，半成品，“微影PCBA”物料大类/组，额外扩9000，半成品、成品“微影可见光组件”物料大类/组，额外扩8000
    </li>
    <li>2460，成品/半成品，“睿影客供标识范围”物料大类/组，额外扩9000</li>
    <li>2162，根据“工厂物料配置-2162工厂额外视图配置”额外扩2160/8000工厂</li>
    <li>2650，根据“2650额外工厂配置类型”配置额外扩工厂</li>
    <li>4010--4010额外工厂配置类型</li>
    <li>2212--2212额外工厂配置类型</li>
    <li>2552--2552额外工厂配置类型</li>
</ol>
<p>3. 如果主签全是范围外, 处理随签非WIP物料的状态，并发SAP更改状态接口</p>
<p>4. 范围内，mbom承接自动创建MBOM逻辑</p>
<ol>
    <li>创建M视图若存在指定视图则返回指定视图对象</li>
    <li>若M视图为WIP状态，升小版</li>
    <li>BOM第一层子件扩视图（存在子件的物料不扩展）</li>
    <li>收集 非D2-E4状态的M视图，启子流程</li>
    <li>更新反冲物料标识</li>
</ol>
<p>（5.1）如果是2280或9000，且属于“工厂物料配置-机器人PCBA配置”的物料组</p>
<ul>
    <li>
        <ol>
            <li>获取部件一层子件</li>
            <li>根据子件编号和视图（2280、9000），调sap接口查询物料是否为客供物料</li>
            <li>(2280视图)若BOM子件不在清单内，则赋值物料供应标识为L; 其余子件为空</li>
            <li>
                (2280视图)2280视图若子件不在清单内，刷新父件属性“来源”=购买；采购类型=F采购；特殊采购(设计)=空；其余父件，来源=购买；采购类型=F采购；特殊采购(设计)=30外协
            </li>
            <li>(9000视图) 若BOM子件在清单内，则赋值物料供应标识为K; 其余子件为空</li>
        </ol>
    </li>
</ul>
<p>（5.2）如果是2660视图，且属于“工厂物料配置-机器人PCBA配置”的物料组</p>
<ol>
    <li>获取部件一层子件</li>
    <li>根据子件编号和视图（2660、9000），调sap接口查询物料是否为客供物料</li>
    <li>若BOM子件不在清单内，则赋值物料供应标识为L; 其余子件为空</li>
    <li>
        若子件不在清单内，刷新父件属性“来源”=购买；采购类型=F采购；特殊采购(设计)=空；其余父件，来源=购买；采购类型=F采购；特殊采购(设计)=30外协
    </li>
    <li>更新微影客供标识（2490/9000/8000视图）</li>
</ol>
<p>(6.1)如果是2490/9000视图，且物料类型为成品/半成品，物料大类或物料组属于“微影智能PCBA”物料大类/组，</p>
<ol>
    <li>(2490)若BOM子件不在清单内，则赋值物料供应标识为L; 其余子件为空</li>
    <li>
        (2490)若子件不在清单内，刷新父件属性“来源”=购买；采购类型=F采购；特殊采购(设计)=空；其余父件，来源=购买；采购类型=F采购；特殊采购(设计)=30外协
    </li>
    <li>(9000) 若BOM子件在清单内，则赋值物料供应标识为K; 其余子件为空</li>
</ol>
<p>(6.2)如果是2490/8000，且属于“微影智能可见光组件”物料组</p>
<ol>
    <li>(2490)若BOM子件不在清单内，则赋值物料供应标识为L; 其余子件为空</li>
    <li>
        (2490)若子件不在清单内，刷新父件属性“来源”=购买；采购类型=F采购；特殊采购(设计)=空；其余父件，来源=购买；采购类型=F采购；特殊采购(设计)=30外协
    </li>
    <li>(8000) 若BOM子件在清单内，则赋值物料供应标识为K; 其余子件为空</li>
    <li>更新睿影客供标识（2460/9000）</li>
    <li>物料类型为成品/半成品，物料大类或物料组属于“睿影客供标识范围”物料大类/组</li>
    <li>（2460）若BOM子件不在清单内，则赋值物料供应标识为L; 其余子件为空</li>
    <li>
        （2460）若子件不在清单内，刷新父件属性“来源”=购买；采购类型=F采购；特殊采购(设计)=空；其余父件，来源=购买；采购类型=F采购；特殊采购(设计)=30外协
    </li>
</ol>
<p>(9000)若BOM子件在清单内，则赋值物料供应标识为K; 其余子件为空</p>
<h2><a id="_Toc91091719"></a>流程表达式-启动防爆审核流程（补充流程节点）</h2>
<p>RCMS20211009_037 防爆产品 part2：BOM审核后自动触发关键件评审</p>
<p>物料类型为成品，分类属性-防爆类型不为空时，以所有符合条件的物料作为主签审对象，启动防爆审核流程</p>
<h2>流程表达式- 启动MPN认证流程</h2>
<p><em>PRMS20210630_039 - PLM和SAP变更后制造商信息不一致的优化</em></p>
<p>随签的MPN物料组在系统配置表《MustAuth配置表》中，则触发MPN认证流程</p>
<p>随签MPN状态为未认证时，启动MPN认证流程</p>
<h2>流程表达式- 设置评审对象状态_重新工作</h2>
<p>流程驳回到修改节点时，评审对象状态:</p>
<ul>
    <li>
        <ul>
            <li>审核对象状态为“重新工作”</li>
            <li>随签对象设置为“重新工作”</li>
            <li>随签子件对象设置为“重新工作”（问题：随签子件状态由D1设置为重新工作吗？）</li>
        </ul>
    </li>
</ul>
<p>
    补充逻辑（ext.hikvision.plm.workflow.bomaudit.util.BomAuditOrderUtil.setLCState(primaryBusinessObject,ext.hikvision.plm.workflow.bomaudit.constants.BomAuditOrderConstants.OP_TO_REWORK);）：</p>
<ul>
    <li>获取BOM审签对象,并设置State ：设置BOM主对象生命周期状态，设置正在审阅和重新工作排除原材料</li>
    <li>
        获取随签对象,并设置State：如果部件状态是WIP，则部件是收集部件，改为目标状态，如果不是WIP，则获取部件的最新稳定版本修改状态至目标状态
    </li>
    <li>获取随签子件对象,并设置State：同上</li>
</ul>
<h2><a id="_Toc91091720"></a>流程表达式- 删除差异报表</h2>
<p>流程驳回到修改节点时，删除差异报表</p>
<h2><a id="_Toc91091721"></a>流程表达式- 设置评审对象状态</h2>
<p>取消流程时，评审对象设置为初始状态</p>
<h2><a id="_Toc91091722"></a>流程表达式- 设置流程状态</h2>
<table border='1px' cellspacing='0'>
    <tr>
        <td><p>节点</p></td>
        <td><p>设置状态</p></td>
    </tr>
    <tr>
        <td><p>设置PBO状态_正在审阅</p></td>
        <td><p>提交流程后，表单设置为正在审阅状态</p></td>
    </tr>
    <tr>
        <td><p>设置PBO状态_重新工作</p></td>
        <td><p>流程驳回后，表单设置为重新工作状态</p></td>
    </tr>
    <tr>
        <td><p>设置PBO状态_废弃</p></td>
        <td><p>流程取消后，表单设置为废弃状态</p></td>
    </tr>
    <tr>
        <td><p>设置PBO状态_已发布</p></td>
        <td><p>流程正常结束后，表单设置为已发布状态</p></td>
    </tr>
</table>
<h1>接口</h1>
<table border='1px' cellspacing='0'>
    <tr>
        <td><p>序号</p></td>
        <td><p>接口</p></td>
        <td><p>功能</p></td>
        <td><p>对接系统</p></td>
        <td></td>
    </tr>
    <tr>
        <td><p>1</p></td>
        <td><p>提供创建BOM接口</p></td>
        <td><p>ITRMS20190221_007</p>
            <p>机器人试制流程触发BOM审核流程</p></td>
        <td></td>
        <td></td>
    </tr>
</table>
<h1>其他</h1>
<ol>
    <li>RMS20201231_025BOM签审、ECN、研发数据发布拦截记录</li>
</ol>
<p>在第一次提交时，记录一个RoHSCheckLog，时间为提交校验的时间。再次提交因为以及记录了流程单号，不再写。</p>
<p>
    判断逻辑：点一下记一下，点两下记两下，然后第二次提交后产品编号了，把流程单号刷到最早的，不是最早的再删除。配置表记录流程类型和时间戳或散列值</p>
<table border='1px' cellspacing='0'>
    <tr>
        <td><p><strong>序号</strong></p></td>
        <td><p><strong>环保校验的提示类型</strong></p></td>
        <td><p><strong>相关流程</strong></p></td>
    </tr>
    <tr>
        <td><p>1</p></td>
        <td><p>
            原材料常规:以下物料未维护环保RoHS2.0文件，存在环保风险，若销售地区为海外/全球，产品将限制发布。（取自合规信息页）</p>
        </td>
        <td><p>BOM审核和ECA</p></td>
    </tr>
    <tr>
        <td><p>2</p></td>
        <td><p>
            原材料设计件无AML管理：以下物料由于供应商未签署RoHS协议，属环保风险物料。请转入制造商部件管理，并维护相关RoHS2.0符合性证明资料。（取自供应商协议数据库）</p>
        </td>
        <td><p>BOM审核和ECA</p></td>
    </tr>
    <tr>
        <td><p>3</p></td>
        <td><p>环保标识：以下物料环保标识值为非RoHS物料，产品需经过报备申请才能使用。（取自IPN类型属性）</p></td>
        <td><p>BOM审核和ECA</p></td>
    </tr>
    <tr>
        <td><p>4</p></td>
        <td><p>
            环保类型：以下外购成品环保类型不符合RoHS2.0(十项)，存在环保风险，若销售地区为海外/全球，产品将限制发布。（取自IPN类型属性）</p>
        </td>
        <td><p>BOM审核和ECA</p></td>
    </tr>
    <tr>
        <td><p>5</p></td>
        <td><p>原材料常规:以下产品销售地区为海外，物料未维护环保RoHS2.0文件，产品限制发布。（取自合规信息页）</p></td>
        <td><p>研发数据发布</p></td>
    </tr>
    <tr>
        <td><p>6</p></td>
        <td><p>环保标识：以下物料环保标识值为非RoHS物料，产品需经过报备申请才能使用。（取自IPN类型属性）</p></td>
        <td><p>研发数据发布</p></td>
    </tr>
    <tr>
        <td><p>7</p></td>
        <td><p>
            环保类型：以下外购成品环保类型不符合RoHS2.0(十项)，存在环保风险，若销售地区为海外/全球，产品将限制发布。（取自IPN类型属性）</p>
        </td>
        <td><p>研发数据发布</p></td>
    </tr>
</table>
<p>（2） BOM物料诊断报告，BOM分析（新物料，替代，设计要求，产品BOM物料优选率）这些需要在流程开发时实现吗？ （问题to开发）</p>
</body>
</html>
    